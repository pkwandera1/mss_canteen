<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSS Canteen Shopkeeping App</title>
</head>
<body>
    
      <header>
        <!-- Place this inside your <header> -->
        <button id="menuToggle" class="menu-toggle">‚ò∞</button>
      </header>  
      
    <div class="container">
            <div id="sidebarOverlay" class="sidebar-overlay hidden"></div>
            <!-- Sidebar navigation menu -->
            <aside class="sidebar">
                <h1>MSS Canteen System</h1>
                <section id="home">
                  <h2>Welcome to MSS Canteen Management üëã</h2>
                    <p>Use the navigation bellow to manage products, record sales, check stock levels, view reports, and back up your data.</p>
                  </section>
                  
                  <nav>
                    <!-- Daily Operations -->
                    <h4>Operations</h4>
                    <button onclick="showSection('salesPage')">üõí Record Sale</button>
                    <button onclick="showSection('mpesa-section')">üì≤ Mpesa Payments</button>
                    <button id="nav-credit-btn" onclick="showSection('credit-section')">üí≥ Credit</button>
                    <button onclick="showSection('productManagementSection')">üì¶ Restock Product</button>
                    <h4>Expenses</h4>
                    <button onclick="showSection('dailyExpensesSection')">Daily Expenses</button>
                  
                    <!-- Registers -->
                    <h4>Registers</h4>
                    <button onclick="showSection('registerProductSection')">üìù Register Product</button>
                    <button onclick="showSection('expenseTypeSection')">üßæ Expense Type Register</button>
                  
                    <!-- Reports -->
                    <h4>Reports</h4>
                    <button onclick="showSection('salesFilters')">üìÖ Sales Reports</button>
                    <button onclick="showSection('weeklyReportSection')">üìÜ Weekly Report</button>
                    <button onclick="showSection('monthlyReportSection')">üìä Monthly Report</button>
                    <button onclick="showSection('expenseHistorySection')">üí∏ Expense History</button>
                  
                    <!-- Utilities -->
                    <h4>Utilities</h4>
                    <button onclick="showSection('backupAndRestore')">üíæ Backup & Restore</button>
                    <!-- Optional: Uncomment if you want reset -->
                    <!-- <button id="resetAppBtn">üßπ Reset App</button> -->
                  </nav>                  
                  
            </aside>
            <!-- Sales Section -->
            <section id="salesPage">
                <h2>Record a Sale</h2>
                <label for="productDropdown">Select Product:</label>
                <select id="productDropdown">
                    <option value="">Select a product</option>
                </select>

                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" min="1" required>

                <button id="recordSaleBtn">Record Sale</button>
                
                <label for="reportDate">Report Date:</label>
                <input type="date" id="reportDate" />
                <button id="viewReportBtn">View Report</button>
                <h2>Sales Report</h2>
                <table id="salesReport" border="1">
                    <thead>
                        <tr>
                            <th>Select</th>
                            <th>Product ID</th>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Total Buying Price</th>
                            <th>Total Selling Price</th>
                            <th>Profit</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sales data will be dynamically inserted here -->
                    </tbody>
                </table>

                <button id="deleteSaleButton">Delete Selected Sales</button>
            </section>
              <!--Mpesa Payments-->
            <section id="mpesa-section"  class="hidden">
                <h2>Mpesa Payments</h2>
                <label for="mpesaType">Payment Type:</label>
                <select id="mpesaType" required>
                  <option value="" disabled selected>Payment type</option>
                  <option value="Sale">Sale</option>
                  <option value="Credit Payment">Credit Payment</option>
                </select>
                <div class="form-group">
                  <label for="mpesaName">Name</label>
                  <input type="text" id="mpesaName" placeholder="Enter name" />
                </div>
              
                <div class="form-group">
                  <label for="mpesaAmount">Amount (KES)</label>
                  <input type="number" id="mpesaAmount" placeholder="Enter amount" />
                </div>
              
                <button id="mpesaBtn">Record Mpesa</button>
              
                <div class="filters">
                  <input type="text" id="mpesaSearch" placeholder="Search by name" />
                  <input type="date" id="mpesaFromDate" />
                  <input type="date" id="mpesaToDate" />
                </div>
              
                <table id="mpesaTable">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Amount (KES)</th>
                      <th>Type</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Mpesa rows will be injected here -->
                  </tbody>
                </table>
            </section>                
              
              <!--Credit Sales-->
            <section id="credit-section" class="hidden">
                <h2>Credit Records</h2>
              
                <div class="form-group">
                  <label for="creditName">Customer Name</label>
                  <input type="text" id="creditCustomerName" placeholder="Enter name" />
                </div>
              
                <div class="form-group">
                  <label for="creditItem">Item Taken</label>
                  <select id="creditProductDropdown">
                    <option value="">Select a product</option>
                  </select>
                </div>
              
                <div class="form-group">
                  <label for="creditAmount">Amount Owed (KES)</label>
                  <input type="number" id="creditQuantity" placeholder="Enter total amount" />
                </div>
              
                <button id="creditBtn">Record Credit</button>
              
                <div class="filters">
                  <input type="text" id="creditSearch" placeholder="Search by name" />
                  <input type="date" id="creditFromDate" />
                  <input type="date" id="creditToDate" />
                </div>
              
                <table id="creditTable">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Item</th>
                      <th>Amount</th>
                      <th>Paid</th>
                      <th>Balance</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Credit rows will be injected here -->
                  </tbody>
                  <tfoot>
                    <tr id="creditTotals">
                      <!-- Totals will be injected here -->
                    </tr>
                  </tfoot>
                </table>
            </section>
              
              
            <!-- Product Management Section -->
            <section id="productManagementSection" class="hidden">
                <h2>Manage Products</h2>

                <!-- Select Product (Searchable Dropdown) -->
                <label for="productStockDropdown">Select Product:</label>
                <select id="productStockDropdown"></select>

                <!-- Stock Quantity Input -->
                <label for="stockQuantity">Stock Quantity:</label>
                <input type="number" id="stockQuantity" placeholder="Enter Stock Quantity" required>

                <button id="restockBtn">Restock</button>

                <!-- Products in Stock Table -->
                <h3>Products in Stock</h3>
                <table id="productStockTable">
                    <thead>
                        <tr>
                            <th>Product ID</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Stock Quantity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Products will be dynamically inserted here -->
                    </tbody>
                </table>
            </section>

            
            <!-- Register New Product Section -->
            <section id="registerProductSection" class="hidden">
                <h2>Register New Product</h2>

                <label for="productId">Product ID:</label>
                <input type="text" id="productId" oninput="this.value = this.value.toUpperCase()" placeholder="Enter Product ID (Letters & Numbers)" required>

                <label for="productName">Product Name:</label>
                <input type="text" id="productName" placeholder="Enter Product Name" required>

                <label for="productCategory">Category:</label>
                <input type="text" id="productCategory" placeholder="Enter Product Category" required>

                <label for="buyingPrice">Buying Price:</label>
                <input type="number" id="buyingPrice" placeholder="Enter Buying Price" required>

                <label for="sellingPrice">Selling Price:</label>
                <input type="number" id="sellingPrice" placeholder="Enter Selling Price" required>

                <button id="addProductBtn">Add Product</button>

                <!-- Product Register Table -->
                <h3>Product Register</h3>
                <table id="productRegister">
                    <thead>
                        <tr>
                            <th>Product ID</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Buying Price</th>
                            <th>Selling Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Products will be dynamically inserted here -->
                    </tbody>
                </table>
            </section>
            <!-- Sales filters -->
            <section id="salesFilters" class="hidden">
                <h2>Sales Filters</h2>

                <label for="filterPeriod">Filter by Period:</label>
                <select id="filterPeriod">
                    <option value="">Select Period</option>
                    <option value="today">Today</option>
                    <option value="thisWeek">This Week</option>
                    <option value="thisMonth">This Month</option>
                    <option value="custom">Custom Date Range</option>
                </select>
                
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate" disabled>
                
                <label for="endDate">End Date:</label>
                <input type="date" id="endDate" disabled>
                
                <label for="filterProduct">Filter by Product:</label>
                <select id="filterProduct">
                    <option value="">All Products</option>
                </select>
                
                <label for="filterCategory">Filter by Category:</label>
                <select id="filterCategory">
                    <option value="">All Categories</option>
                </select>
                
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>Select</th>
                            <th>Product ID</th>
                            <th>Product Name</th>
                            <th>Quantity</th>
                            <th>Total Buying Price</th>
                            <th>Total Selling Price</th>
                            <th>Profit</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                      <tr id="creditTotals"></tr> 
                    </tfoot>
                </table>            
            </section>

            <!-- Expense Type Register -->
            <section id="expenseTypeSection" class="hidden">
                <h2>Register Expense Type</h2>
                <input id="expenseTypeId" placeholder="Expense ID (e.g. EXP001)" />
                <input id="expenseLabel" placeholder="Expense Label (e.g. Labour, Transport)" />
                <button id="addExpenseTypeBtn">Add Expense Type</button>
            
                <h3>Expense Type Register</h3>
                <table id="expenseTypeRegister">
                <thead>
                    <tr>
                    <th>ID</th><th>Label</th>
                    </tr>
                </thead>
                <tbody></tbody>
                </table>
            </section>
                <!-- Daily Expenses -->
            <section id="dailyExpensesSection" class="hidden">
                <h2>Daily Expenses</h2>
              
                <!-- Expense input -->
                <select id="expenseDropdown"></select>
                <input id="expenseAmount" type="number" placeholder="Amount (Ksh)" />
                <input id="expenseNote" placeholder="Optional Note" />
                <button id="addExpenseBtn">Add Expense</button>
              
                <!-- Report table -->
                <h3>Today's Expenses</h3>
                <table id="dailyExpenseTable">
                  <thead>
                    <tr><th>Type</th><th>Amount</th><th>Note</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              
                <p><strong>Total Expenses:</strong> <span id="totalExpenses">Ksh 0.00</span></p>
                <p><strong>Net Profit (Sales ‚àí Expenses):</strong> <span id="netProfit">Ksh 0.00</span></p>

                <div id="salesTotals" style="margin-top: 1rem; font-size: 0.95rem;"></div>
              </section>

                <!-- Weekly Report Controls -->
            <section id="weeklyReportSection" class="hidden">   
              <div style="margin-bottom: 1rem;">
                <button id="prevWeekBtn">‚èÆÔ∏è Previous Week</button>
                <button id="nextWeekBtn">‚è≠Ô∏è Next Week</button>
                <button id="loadWeeklyReportBtn">üîÑ Load This Week</button>
                <button id="printWeeklyReportBtn">üñ®Ô∏è Print Report</button>
                <button id="exportWeeklyReportBtn">üíæ Export as CSV</button>
              </div>

              <!-- Week Range Display -->
              <div id="weekRangeLabel" style="margin-bottom: 1rem; font-weight: bold;"></div>

              <!-- Weekly Report Table -->
              <table id="weeklyReportTable" class="report-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Total Sales</th>
                    <th>Profit</th>
                    <th>Expenses</th>
                    <th>Mpesa Sales</th>
                    <th>Credit Issued</th>
                    <th>Credit Payments</th>
                    <th>Mpesa Credit Payments</th>
                    <th>Net Profit</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Rows will be dynamically inserted by JavaScript -->
                </tbody>
              </table>
            </section>
              <!--Monthly Report-->
              <section id="monthlyReportSection" class="hidden">
                <h2>Monthly Report</h2>
              
                <label for="reportMonth">Select Month:</label>
                <input type="month" id="reportMonth" />
              
                <button id="loadMonthlyReportBtn">Load Report</button>
                <div style="margin-top: 1rem;">
                    <button id="printMonthlyReportBtn">üñ®Ô∏è Print Report</button>
                    <button id="exportMonthlyReportBtn">üíæ Export as CSV</button>
                </div>
                  
              
                <table id="monthlyReportTable" class="table table-striped table-bordered">
                  <thead class="thead-dark">
                    <tr>
                      <th>Date</th>
                      <th>Total Sales</th>
                      <th>Profit</th>
                      <th>Expenses</th>
                      <th>Mpesa Sales</th>
                      <th>Credit Issued</th>
                      <th>Credit Payments</th>
                      <th>Mpesa Credit Payments</th>
                      <th>Net Profit</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Rows will be dynamically inserted by monthlyReport.js -->
                  </tbody>
                  <tfoot>
                    <!-- Totals row will be inserted by monthlyReport.js -->
                  </tfoot>
                </table>
              </section>
              <!--Expense History-->
              <section id="expenseHistorySection" class="hidden">
                <h2>Expense History</h2>
              
                <label for="expenseHistoryMonth">Select Month:</label>
                <input type="month" id="expenseHistoryMonth" />
                <button id="loadExpenseHistoryBtn">Load Expenses</button>
              
                <table id="expenseHistoryTable">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Type</th>
                      <th>Amount</th>
                      <th>Note</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              
                <p><strong>Total Expenses:</strong> <span id="expenseHistoryTotal">Ksh 0.00</span></p>
              </section>
              
                <!--Backup and Restore-->
            <section id="backupAndRestore" class="hidden">
                <h2>Backup & Restore</h2>
                
                <!-- Export -->
                <button id="backupBtn">Export Backup</button>
                
                <!-- Import -->
                <label for="restoreFileInput" style="display:block; margin-top: 1rem;">Import Backup:</label>
                <input type="file" id="restoreFileInput" accept="application/json" />
              </section>
              
    </div>
    <!-- Price History Modal -->
    <div id="priceHistoryModal" class="modal hidden">
        <div class="modal-content">
        <span id="closePriceHistoryModal" class="close">&times;</span>
        <h2>Price History</h2>
        <ul id="priceHistoryList"></ul>
        </div>
    </div>
    <div id="loader" style="position: fixed; top: 0; left: 0; 
       width: 100%; height: 100%; background: white; 
       display: flex; justify-content: center; align-items: center; 
       font-size: 1.5rem; z-index: 9999;">
    Loading Canteen App...
    </div>

    <div id="app"></div>
    <script src="bundle.js" defer></script>
    <script>
        // Hide loader when app is ready
        window.addEventListener('load', () => {
          const loader = document.getElementById('loader');
          if (loader) loader.style.display = 'none';
        });
      </script>
</body>
</html>
